## 3.1 版本化

原则上，语言的一个新版本是一个清理的机会，可以清理过时的特性或者改变特性的工作方式。这意味着新的代码在语言的旧的实现中无法工作，老的代码在新的实现中无法工作。每段代码都和特定的语言版本关联。针对两个不同语言版本写两种不同代码是很常见的。

首先，你可以使用一种“用所有还是什么都不用”的方式：如果一个代码库需要使用新的语言版本，就必须彻底升级。Python 在从 Python 2 升级到 Python 3 的时候就是这样的。这样的话有个问题，将已有的代码库一次性全部升级可能是做不到的，尤其是代码库很大的时候。而且，这种方式对于 web 来说是不可行的，因为总是有老代码，而且 JavaScript 引擎会自动升级。

第二，你可以让一个代码库包含在多个语言版本都可运行的代码，通过根据版本切换代码的方式。你可以通过一个专用的[互联网媒体类型](http://en.wikipedia.org/wiki/Internet_media_type)标记 ECMAScript 6 的代码。这样的媒体类型可以和一个 HTTP 头关联在一起：

```
Content-Type: application/ecmascript;version=6
```

也可以和 `<script>` 元素中的 `type` 属性关联在一起（ `type` [默认值](http://www.w3.org/TR/html5/scripting-1.html#attr-script-type)是 `text/javascript` ）：

```html
<script type="application/ecmascript;version=6">
    ···
</script>
```

这是在代码之外指定版本。另一种方案是在代码内指定版本。例如，将下面的代码放在 JavaScript 文件的第一行：

```js
use version 6;
```

两种标记的方法都很容易产生问题：外部版本标记法很脆弱，容易丢失；内部版本标记法又会使代码显得杂乱。

一个更根本的问题是，针对不同的语言版本，要维护不同的执行引擎。这就引起了一些问题：

* 引擎变得臃肿，因为要实现所有版本的语义。对于分析语言的工具也带来了同样的问题（比如类型检测， JSLint ）。
* 开发者需要记住版本之间的不同点。
* 代码变得更加难以重构，因为在移动代码的时候需要考虑语言版本的问题。

因此，应该避免版本化，尤其是 JavaScript 和 web 。
