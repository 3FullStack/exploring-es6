<!DOCTYPE html>
<html>
<head>
    <title>探索 ES6</title>
    <link rel="stylesheet" type="text/css" href="./css/github-markdown.css">
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <script src="./js/kramed.min.js"></script>
    <script src="./js/jquery-2.1.4.min.js"></script>
</head>
<body class="markdown-body">
    <div class="index"></div>
    <div class="content"></div>
    <script>
    renderIndex();

    function renderIndex() {
        $.get('./index.md')
            .done(function (data) {
                $('.index').html(kramed(data));
                bindIndexEvents();
            });
    }

    function bindIndexEvents() {
        $('.index a').on('click', function (event) {
            event.preventDefault();
            event.stopPropagation();

            $('.index a.current').removeClass('current');
            $(event.target).addClass('current');

            addLoadingLayer();
            $.get(event.target.href).done(function (data) {
                $('.content').html(kramed(data));
                positionContent();
                removeLayer();
            });
        });

        $(window).on('scroll', positionContent);
    }

    function positionContent() {
        $('.content').css({
            height: $(window).height(),
            top: $(window).scrollTop()
        }).scrollTop(0);
    }

    function addLoadingLayer() {
        if (addLoadingLayer.$layer) {
            return;
        };
        var $layer = $([
            '<div class="layer">',
                '<div class="cover"></div>',
                '<div class="tip">加载中...</div>',
            '</div>'
        ].join(''));
        $('body').append($layer);
        addLoadingLayer.$layer = $layer;
    }

    function removeLayer() {
        if (addLoadingLayer.$layer) {
            addLoadingLayer.$layer.remove();
            addLoadingLayer.$layer = undefined;
        }
    }
    </script>
</body>
</html>