<!DOCTYPE html>
<html>
<head>
    <title>探索 ES6</title>
    <link rel="stylesheet" type="text/css" href="./css/github-markdown.css">
    <link rel="stylesheet" type="text/css" href="./js/highlight/default.min.css">
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <script src="./js/marked.min.js"></script>
    <script src="./js/highlight/highlight.min.js"></script>
    <script src="./js/jquery-2.1.4.min.js"></script>
</head>
<body class="markdown-body">
    <div class="head">
        <span class="book-name">探索 ES6</span> 翻译自<a href="https://leanpub.com/exploring-es6/read">《 Exploring ES6 》</a>
        <a class="project-location" href="https://github.com/es6-org/exploring-es6">GitHub</a>
    </div>
    <div class="index"></div>
    <div class="content"></div>
    <script>
    marked.setOptions({
        highlight: function (code) {
            return hljs.highlightAuto(code).value;
        }
    });

    renderIndex();

    function renderIndex() {
        $.get('./index.md')
            .done(function (data) {
                marked(data, function (err, content) {
                    $('.index').html(content);
                    bindIndexEvents();
                });
            });
    }

    function bindIndexEvents() {
        $('.index a').on('click', function (event) {
            event.preventDefault();
            event.stopPropagation();

            $('.index a.current').removeClass('current');
            $(event.target).addClass('current');

            addLoadingLayer();
            $.get(event.target.href).done(function (data) {
                marked(data, function (err, content) {
                    $('.content').html(content);
                    removeLayer();
                });
            });
        });
    }

    function addLoadingLayer() {
        if (addLoadingLayer.$layer) {
            return;
        };
        var $layer = $([
            '<div class="layer">',
                '<div class="cover"></div>',
                '<div class="tip">加载中...</div>',
            '</div>'
        ].join(''));
        $('body').append($layer);
        addLoadingLayer.$layer = $layer;
    }

    function removeLayer() {
        if (addLoadingLayer.$layer) {
            addLoadingLayer.$layer.remove();
            addLoadingLayer.$layer = undefined;
        }
    }
    </script>
</body>
</html>